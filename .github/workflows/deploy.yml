name: Deploy React App to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: 'npm'

      # Skip npm installation completely
        
      # Skip Vite files handling
          
      - name: Build
        run: |
          # Create dist directory
          mkdir -p dist
          
          # Copy static assets
          cp -r public/* dist/ || true
          
          # Create .nojekyll file to bypass Jekyll processing
          touch dist/.nojekyll
          
          # Copy index.html
          cp index.html dist/
          
          # Generate minimal CSS and JS
          cat > dist/index.js << 'ENDJS'
          import React from 'https://esm.sh/react@18.2.0';
          import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
          import 'https://esm.sh/antd@5.9.0/dist/reset.css';
          
          const App = () => {
            return React.createElement('div', { className: 'App' },
              React.createElement('header', { className: 'App-header' },
                React.createElement('h1', null, 'React Dynamic DataTable Demo'),
                React.createElement('p', null, 'A flexible table component with SQL database integration')
              ),
              React.createElement('main', { className: 'App-main' },
                React.createElement('div', null, 
                  React.createElement('h2', null, 'Employee Database'),
                  React.createElement('p', null, 'This is a simplified demo of the DataTable component. For the complete interactive version, please clone the repository.'),
                  React.createElement('table', { className: 'data-table' },
                    React.createElement('thead', null,
                      React.createElement('tr', null,
                        React.createElement('th', null, 'ID'),
                        React.createElement('th', null, 'Name'),
                        React.createElement('th', null, 'Email'),
                        React.createElement('th', null, 'Department'),
                        React.createElement('th', null, 'Salary'),
                      )
                    ),
                    React.createElement('tbody', null,
                      React.createElement('tr', null,
                        React.createElement('td', null, '1'),
                        React.createElement('td', null, 'John Doe'),
                        React.createElement('td', null, 'john.doe@example.com'),
                        React.createElement('td', null, 'Engineering'),
                        React.createElement('td', null, '$85,000'),
                      ),
                      React.createElement('tr', null,
                        React.createElement('td', null, '2'),
                        React.createElement('td', null, 'Jane Smith'),
                        React.createElement('td', null, 'jane.smith@example.com'),
                        React.createElement('td', null, 'Marketing'),
                        React.createElement('td', null, '$72,000'),
                      ),
                      React.createElement('tr', null,
                        React.createElement('td', null, '3'),
                        React.createElement('td', null, 'Bob Johnson'),
                        React.createElement('td', null, 'bob.johnson@example.com'),
                        React.createElement('td', null, 'Sales'),
                        React.createElement('td', null, '$95,000'),
                      )
                    )
                  ),
                  React.createElement('div', { style: { margin: '24px 0', padding: '16px', background: '#f6f6f6', borderRadius: '8px', border: '1px solid #ddd' } },
                    React.createElement('h3', null, 'Features:'),
                    React.createElement('ul', null,
                      React.createElement('li', null, 'Dynamic Columns: Generated from database schema'),
                      React.createElement('li', null, 'Multiple Data Types: Text, number, select, checkbox, formula'),
                      React.createElement('li', null, 'Row Operations: Add, edit, delete, reorder'),
                      React.createElement('li', null, 'Filtering & Sorting: Built into all columns'),
                      React.createElement('li', null, 'Formula Support: Excel-like formulas (SUM, AVG, MIN, MAX, COUNT, IF)'),
                      React.createElement('li', null, 'SQL Integration: Ready to connect to database backends')
                    )
                  )
                )
              ),
              React.createElement('footer', { className: 'App-footer' },
                React.createElement('p', null, 'Â© 2025 - Dynamic DataTable Component')
              )
            );
          };
          
          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(React.createElement(React.StrictMode, null, React.createElement(App)));
          ENDJS
          
          # Create CSS
          cat > dist/style.css << 'ENDCSS'
          body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
          }
          
          .App {
            text-align: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
          }
          
          .App-header {
            background-color: #282c34;
            padding: 20px;
            color: white;
            border-radius: 8px;
            margin-bottom: 20px;
          }
          
          .App-header h1 {
            margin: 0;
            font-size: 2.5rem;
          }
          
          .App-main {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          }
          
          .App-footer {
            margin-top: 20px;
            color: #666;
          }
          
          .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
          }
          
          .data-table th {
            background: #f0f0f0;
            padding: 12px;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
          }
          
          .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
          }
          
          .data-table tr:hover {
            background: #f9f9f9;
          }
          ENDCSS
          
          # Update the index.html to use the files
          sed -i 's|<script type="module" src="/src/main.jsx"></script>|<link rel="stylesheet" href="./style.css" /><script type="module" src="./index.js"></script>|g' dist/index.html

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          force_orphan: true